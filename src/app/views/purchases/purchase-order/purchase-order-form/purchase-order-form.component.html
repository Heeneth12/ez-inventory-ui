<div class="min-h-screen bg-gray-50 p-6">
  <form [formGroup]="poForm" (ngSubmit)="onSubmit()">
    <div class="max-w-7xl mx-auto">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        
        <!-- Main Content - Left Side -->
        <div class="lg:col-span-2 space-y-6">
          <!-- PO Info Card -->
          <div class="bg-white rounded-2xl shadow-sm border border-gray-200 p-8">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-8">
              
              <!-- Left Column -->
              <div>
                <h3 class="text-lg font-bold text-gray-900 mb-6">Purchase Order Number</h3>
                <div class="space-y-3">
                  <div>
                    <p class="text-gray-900 font-bold text-xl font-mono">
                      {{ isEditMode ? 'PO-' + poId : 'NEW-DRAFT' }}
                    </p>
                  </div>
                  <div>
                    <p class="text-sm text-gray-500">Issued Date: </p>
                  </div>
                  <div>
                    <label class="text-sm text-gray-500 block mb-1">Due Date:</label>
                    <input type="date" formControlName="expectedDeliveryDate" 
                           class="text-gray-900 border-b border-gray-300 focus:border-emerald-500 outline-none pb-1 text-sm">
                  </div>
                </div>
              </div>

              <!-- Right Column -->
              <div>
                <h3 class="text-lg font-bold text-gray-900 mb-6">Ship To</h3>
                <div class="space-y-2">
                  <div class="relative">
                    <select formControlName="warehouseId" 
                            class="w-full text-gray-900 border-b border-gray-300 focus:border-emerald-500 outline-none pb-2 text-sm appearance-none cursor-pointer bg-transparent">
                      <option [ngValue]="null">Select warehouse...</option>
                      <option *ngFor="let w of warehouseList" [value]="w.id">{{ w.name }}</option>
                    </select>
                  </div>
                  <div *ngIf="poForm.get('warehouseId')?.value" class="text-sm text-gray-500 mt-2">
                    <p>Warehouse Address Line 1</p>
                    <p>City, State ZIP</p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Item Details Card -->
          <div class="bg-white rounded-2xl shadow-sm border border-gray-200 p-8">
            <div class="mb-6">
              <h3 class="text-lg font-bold text-gray-900">Item Details</h3>
              <p class="text-sm text-gray-400 mt-1">Details item with more info</p>
            </div>

            <!-- Table Header -->
            <div class="hidden md:grid grid-cols-12 gap-4 pb-4 mb-4 text-sm font-medium text-gray-400 uppercase tracking-wider">
              <div class="col-span-5">ITEM</div>
              <div class="col-span-2 text-center">ORDER/TYPE</div>
              <div class="col-span-2 text-center">RATE</div>
              <div class="col-span-3 text-right">AMOUNT</div>
            </div>

            <!-- Items List -->
            <div formArrayName="items" class="space-y-4">
              <div *ngFor="let item of itemsFormArray.controls; let i = index" [formGroupName]="i">
                
                <div class="grid grid-cols-1 md:grid-cols-12 gap-4 py-4 border-b border-gray-100 items-center">
                  
                  <!-- Item Name with Search -->
                  <div class="col-span-1 md:col-span-5 relative typeahead-container">
                    <label class="md:hidden text-xs font-semibold text-gray-500 mb-2 block uppercase">Item</label>
                    <input type="text" 
                           [value]="getItemName(i)" 
                           (input)="onItemSearch($event, i)"
                           (focus)="onItemSearch($event, i)"
                           placeholder="Search product..."
                           class="w-full text-gray-900 font-medium text-sm border-0 focus:ring-0 p-0 placeholder-gray-400">
                    
                    <!-- Search Results Dropdown -->
                    <div *ngIf="activeItemSearchIndex === i && itemSearchResults.length > 0" 
                         class="absolute z-50 mt-2 w-full bg-white rounded-lg shadow-xl border border-gray-200 max-h-60 overflow-y-auto">
                      <ul>
                        <li *ngFor="let res of itemSearchResults" 
                            (click)="selectItem(res, i)"
                            class="px-4 py-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-0">
                          <div class="font-medium text-gray-900 text-sm">{{ res.name }}</div>
                          <div class="text-xs text-gray-400 mt-1">SKU: {{ res.itemCode || 'N/A' }} â€¢ {{ res.purchasePrice | currency }}</div>
                        </li>
                      </ul>
                    </div>
                  </div>

                  <!-- Quantity -->
                  <div class="col-span-1 md:col-span-2">
                    <label class="md:hidden text-xs font-semibold text-gray-500 mb-2 block uppercase">Qty</label>
                    <input type="number" formControlName="orderedQty" min="1"
                           class="w-full text-center text-gray-900 font-medium text-sm border-0 focus:ring-0 p-0 bg-gray-50 rounded px-3 py-2">
                  </div>

                  <!-- Rate -->
                  <div class="col-span-1 md:col-span-2">
                    <label class="md:hidden text-xs font-semibold text-gray-500 mb-2 block uppercase">Rate</label>
                    <div class="flex items-center justify-center">
                      <span class="text-gray-900 font-medium text-sm">
                        ${{ item.get('unitPrice')?.value || 0 }}
                      </span>
                    </div>
                  </div>

                  <!-- Amount -->
                  <div class="col-span-1 md:col-span-2 text-right">
                    <label class="md:hidden text-xs font-semibold text-gray-500 mb-2 block uppercase">Amount</label>
                    <span class="text-gray-900 font-bold text-sm">
                      ${{ (item.get('orderedQty')?.value * item.get('unitPrice')?.value) || 0 }}.00
                    </span>
                  </div>

                  <!-- Delete -->
                  <div class="col-span-1 md:col-span-1 flex justify-end md:justify-center">
                    <button type="button" (click)="removeItem(i)" 
                            class="text-gray-400 hover:text-red-500 transition-colors">
                      <i class="fas fa-trash text-sm"></i>
                    </button>
                  </div>
                </div>

              </div>
            </div>

            <!-- Add Item Button -->
            <button type="button" (click)="addItem()" 
                    class="mt-6 text-emerald-600 hover:text-emerald-700 font-semibold text-sm flex items-center gap-2">
              <span>Add Item</span>
            </button>

            <!-- Totals Section -->
            <div class="mt-8 space-y-3">
              <div class="flex justify-between items-center text-sm">
                <span class="text-gray-900 font-medium">Subtotal</span>
                <span class="text-gray-900 font-bold">${{ grandTotal || 0 }}.00</span>
              </div>
              
              <div class="flex justify-between items-center text-sm">
                <span class="text-gray-900 font-medium">Discount</span>
                <button type="button" class="text-emerald-600 hover:text-emerald-700 font-semibold">Add</button>
              </div>
              
              <div class="flex justify-between items-center text-sm">
                <span class="text-gray-900 font-medium">Tax</span>
                <button type="button" class="text-emerald-600 hover:text-emerald-700 font-semibold">Add</button>
              </div>
              
              <div class="flex justify-between items-center pt-4 border-t border-gray-200">
                <span class="text-gray-900 font-bold text-base">Total</span>
                <span class="text-gray-900 font-bold text-xl">${{ grandTotal || 0 }}.00</span>
              </div>
            </div>
          </div>

        </div>

        <!-- Right Sidebar -->
        <div class="lg:col-span-1">
          <div class="sticky top-6 space-y-6">
            
            <!-- Supplier Details Card -->
            <div class="bg-white rounded-2xl shadow-sm border border-gray-200 p-6">
              <div class="flex justify-between items-center mb-6">
                <h3 class="font-bold text-gray-900 text-lg">Client Details</h3>
                <button type="button" class="text-gray-400 hover:text-gray-600">
                  <i class="fas fa-ellipsis-h"></i>
                </button>
              </div>

              <!-- Selected Supplier -->
              <div *ngIf="selectedSupplier" class="mb-6">
                <div class="flex items-center gap-3 mb-4">
                  <div class="w-14 h-14 rounded-full bg-gray-100 flex items-center justify-center flex-shrink-0">
                    <span class="text-gray-600 font-bold text-lg">{{ selectedSupplier.name.charAt(0) }}</span>
                  </div>
                  <div>
                    <h4 class="font-bold text-gray-900">{{ selectedSupplier.name }}</h4>
                    <p class="text-sm text-gray-500">{{ selectedSupplier.email }}</p>
                  </div>
                </div>

                <div class="bg-blue-50 rounded-lg p-4 mb-4">
                  <div class="flex items-center gap-2 mb-2">
                    <i class="fas fa-check-circle text-blue-600"></i>
                    <span class="font-bold text-gray-900">{{ selectedSupplier.name }}</span>
                  </div>
                  <p class="text-sm text-gray-600">{{ selectedSupplier.contactCode }}</p>
                </div>

                <button type="button" 
                        class="w-full py-3 bg-emerald-50 hover:bg-emerald-100 text-emerald-600 font-semibold rounded-lg transition-colors">
                  Add Customer
                </button>

                <button type="button" (click)="selectedSupplier = null; supplierSearchInput = ''; poForm.patchValue({supplierId: null})"
                        class="w-full mt-2 text-sm text-gray-500 hover:text-gray-700">
                  Change Supplier
                </button>
              </div>

              <!-- Supplier Search -->
              <div *ngIf="!selectedSupplier" class="relative typeahead-container">
                <input type="text" 
                       [(ngModel)]="supplierSearchInput" 
                       [ngModelOptions]="{standalone: true}"
                       (input)="onSupplierSearch($event)"
                       (focus)="onSupplierSearch($event)"
                       placeholder="Search supplier..."
                       class="w-full bg-gray-50 border border-gray-200 rounded-lg px-4 py-3 text-sm focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500">

                <div *ngIf="showSupplierDropdown && supplierSearchResults.length > 0" 
                     class="absolute z-50 mt-2 w-full bg-white rounded-lg shadow-xl border border-gray-200 max-h-60 overflow-y-auto">
                  <ul>
                    <li *ngFor="let s of supplierSearchResults" (click)="selectSupplier(s)"
                        class="px-4 py-3 hover:bg-gray-50 cursor-pointer border-b border-gray-100 last:border-0">
                      <div class="font-medium text-gray-900 text-sm">{{ s.name }}</div>
                      <div class="text-xs text-gray-500 mt-1">{{ s.contactCode }}</div>
                    </li>
                  </ul>
                </div>
              </div>
            </div>

            <!-- Basic Info Card -->
            <div class="bg-white rounded-2xl shadow-sm border border-gray-200 p-6">
              <h3 class="font-bold text-gray-900 text-lg mb-6">Basic Info</h3>
              
              <div class="space-y-6">
                <div>
                  <label class="block text-sm text-gray-500 mb-2">Invoice Date</label>
                  <div class="flex items-center justify-between bg-gray-50 rounded-lg px-4 py-3">
                    <span class="text-gray-900 font-medium text-sm"></span>
                    <i class="far fa-calendar text-gray-400"></i>
                  </div>
                </div>

                <div>
                  <label class="block text-sm text-gray-500 mb-2">Due Date</label>
                  <div class="flex items-center justify-between bg-gray-50 rounded-lg px-4 py-3">
                    <input type="date" formControlName="expectedDeliveryDate"
                           class="text-gray-900 font-medium text-sm bg-transparent border-0 focus:ring-0 p-0 w-full">
                    <i class="far fa-calendar text-gray-400"></i>
                  </div>
                </div>
              </div>

              <!-- Action Buttons -->
              <div class="mt-6 space-y-3">
                <button type="submit" 
                        class="w-full py-3.5 bg-lime-400 hover:bg-lime-500 text-gray-900 font-bold rounded-lg transition-colors shadow-sm">
                  {{ isEditMode ? 'Update Order' : 'Send Invoice' }}
                </button>

                <div class="grid grid-cols-2 gap-3">
                  <button type="button" 
                          class="py-3 bg-white border border-gray-200 hover:bg-gray-50 text-gray-700 font-semibold rounded-lg text-sm flex items-center justify-center gap-2 transition-colors">
                    <i class="far fa-eye"></i>
                    <span>Preview</span>
                  </button>
                  <button type="button" 
                          class="py-3 bg-white border border-gray-200 hover:bg-gray-50 text-gray-700 font-semibold rounded-lg text-sm flex items-center justify-center gap-2 transition-colors">
                    <i class="fas fa-download"></i>
                    <span>Download</span>
                  </button>
                </div>
              </div>
            </div>

            <!-- Notes Section -->
            <div class="bg-white rounded-2xl shadow-sm border border-gray-200 p-6">
              <label class="block text-sm font-semibold text-gray-700 mb-3">Notes & Terms</label>
              <textarea formControlName="notes" 
                        class="w-full bg-gray-50 border border-gray-200 rounded-lg px-4 py-3 text-sm text-gray-700 focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 resize-none h-32" 
                        placeholder="Enter additional notes..."></textarea>
            </div>

          </div>
        </div>

      </div>
    </div>
  </form>
</div>